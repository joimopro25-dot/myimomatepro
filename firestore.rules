rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    function isSignedIn() {
      return request.auth != null;
    }
    
    function isConsultant(consultantId) {
      return isSignedIn() && request.auth.uid == consultantId;
    }

    // Consultants root doc
    match /consultants/{consultantId} {
      // Owner can read/write own consultant doc
      allow read, create, update, delete: if isConsultant(consultantId);

      // Any nested collections under a consultant (clients, opportunities, deals, activities, agents, etc.)
      match /{document=**} {
        allow read, create, update, delete: if isConsultant(consultantId);
      }
    }

    // Subscriptions (top-level)
    match /subscriptions/{uid} {
      allow read, create, update, delete: if isSignedIn() && request.auth.uid == uid;
    }

    // Default deny
    match /{path=**} {
      allow read, write: if false;
    }
  }
}